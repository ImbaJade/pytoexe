import os
import random
import time
import sys
import msvcrt

# Устанавливаем размеры поля, включая границы
width = 35
height = 27

# Инициализация переменных
patalliro = [(4, 5)]  # Начальная позиция Паталлиро
direction = (0, 1)  # Начальное направление (вправо)
diamond = (random.randint(1, height - 2), random.randint(1, width - 2))  # Генерация алмаза в пределах границ
dinosaurs = []  # Список для динозавриков
last_dino_time = time.time()  # Время появления последнего динозаврика
collected_diamonds = 0  # Количество собранных алмазов

# Функция для отрисовки поля
def draw_game(patalliro, diamond, dinosaurs):
    os.system('cls' if os.name == 'nt' else 'clear')  # Очистка экрана
    # Отрисовка верхней границы
    print('#' * (width + 2))  # +2 для ограничителей по бокам
    for y in range(height):
        print('#', end='')  # Левый ограничитель
        for x in range(width):
            if (y, x) == patalliro[0]:
                print('P', end='')  # Паталлиро
            elif (y, x) in patalliro[1:]:
                print('o', end='')  # Мешочки
            elif (y, x) == diamond:
                print('*', end='')  # Алмаз
            elif (y, x) in dinosaurs:
                print('D', end='')  # Динозаврики
            else:
                print(' ', end='')
        print('#')  # Правый ограничитель и переход на следующую строку
    # Отрисовка нижней границы
    print('#' * (width + 2))  # +2 для ограничителей по бокам

# Функция для отображения стандартного сообщения "Game Over"
def display_game_over(collected_diamonds):
    game_over_text = f"""\
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@                   @@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@                            @@@@@@@@@@@
@@@@@@@@@@@@                                  @@@@@@@@
@@@@@@@                                         @@@@@@
@@@@                                             @@@@@
@@@                                               @@@@
@@   @@@@@@                                        @@@
@@   @@    @@ @@@                     @             @@
@@   @      @@@@@@@   @@@@@  @@@@@@@  @             @@
@@@  @          @@@@@@@@@@@@@@@@     @              @@
@@@@@@                              @               @@
@@@@@@                              @               @@
@@@@@@@                              @      @@@    @@@
@@@@@@@@ @@@@@@           @@@@@@@@@  @@@@@      @ @@@@
@@@@@ @        @@       @@            @@@  @@    @@@@@
@@@@@@                                    @   @  @@@@@
@@@@@                                    @@  @@  @@@@@
@@@@             @@@                     @   @  @@@@@@
@@@           @@@@@@@@                   @  @  @@@@@@@
@@          @@@@@@@@@@@@                @    @@@@@@@@@
@@         @@@@@@@@@@@@@@               @@@@@@@@@@@@@@
@@           @@@@@@@@@@                 @@@@@@@@@@@@@@
@@@            @@@@@                   @@@@@@@@@@@@@@@
@@@@            @                     @@@@@@@@@@@@@@@@
@@@@@@@@                            @@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@        @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   
Game Over!!! Patalliro spotknulsa!!!
Sobrano almazov: {collected_diamonds}"""

    print(game_over_text)

# Функция для отображения "Game Over" при столкновении с динозавриком
def display_dino_game_over(collected_diamonds):
    dino_game_over_text = f"""\
@@@@@@@@@@@@@@  @@@@@@@        @@@@@@@@@@@@@@@@@
@@@@@@@@@@@    @      @@@@@@@@@   @@@@@@@@@@@@@@
@@@@@@    @@@@@@ @  @@@@@@@@@@@@@  @@@@@@@@@@@@@
@@@   @@@@@@@@@@  @ @@@@@@   @@@@@  @@@@@@@@@@@@
@  @ @ @@@@@@@@ @@@@@@@  @@@@@@@@@@  @@@@@@@@@@@
@ @@@@@@@@@@     @@@@@@@@  @@@@@@@@@  @@@@@@@@@@
@            @@@@     @@@    @@@@@@@@   @@@@@@@@
@@@     @@@@  @  @@@@@@@@@@   @@@@@@@@@  @@@@@@@
@@@@@   @@@@@  @@@@@@@@@@  @@@@@@@@@@@@@@       
@@@@@@@@      @@@@@      @@@@@@@@@@@@@@@@@@@@@@@
@@@@@@     @@@@   @@@@@@@@   @@@@@@@@@ @@@@@@@@@
@@@@@@   @    @@@@@@@@@@@@@@ @@@@@@@@@@ @@@@ @@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@  @@@@@@@@@@   @@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  @@@@@@@  @@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @ @@@  @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  @ @  @@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@    @@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  @@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@      @@@@  @@@@@ @@@@@
@@@@@@@@@@@@@@@@@@@@@@   @@@@@@      @@@@ @@@@@@
@@@@@@@@@@@@@@@@@@@@@ @   @@ @@@@@@@  @@@      @
@@@@@@@@@@@@@@@@@@@         @@         @@    @@ 
@@@@@@@@@@@@@@@@@@@ @    @@@@@   @@@@ @@@   @@@@
@@@@@@@@@@@@@@@@@@@ @ @      @@@@@@@@@  @@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@       @@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@  @@@@@@  @@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@  @   @@ @@@@@@@@@@@@@@@@@@@@
Game Over!!! Patalliro skushal Dinozavrik!!!
Sobrano almazov: {collected_diamonds}"""
    print(dino_game_over_text)

# Показываем дополнительный текст перед началом игры
intro_text = """\
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                     @@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                           @@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                                @@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                                    @@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@                                       @@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@                                         @@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@                                             @@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@     @                                         @@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@    @@@@@@                   @@@@@@@@           @@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@ @@@@@   @@@  @@  @@@    @@@@@@@@@   @          @@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@ @@@     @@@@@@@@@@@@@@@@@@@@@     @           @@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@ @@         @@@@@@@@@@@@@        @@          @@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@                               @@@@@@@    @@@@@@@@@
@@@@@@@@  @@ @@@@@@@@@@@@@@                              @@@@@@@@@@ @@@@@@@@@@
@@@@  @@  @  @@@@@@@@@@@@@@                               @@@@@@ @ @@@@@@@@@@@
@@@@  @  @@  @@@@@@@@@@@@@@@  @@@@@@            @@@@@@@    @@  @@@  @@@@@@@@@@
@@@@ @@  @@  @@@@@@@@@@@@@@         @@       @@                @@@@ @@@@@@@@@@
@@@  @@  @@  @@ @@@@@@@@@@                                    @@@@ @@@@@@@@@@@
@@@ @@@@@@@@@@  @@@@@@@@@                                   @@     @@@@@@@@@@@
@@@         @@  @@@@@@@@@ @    @@@@@@@@@@@@@@@@          @  @@@@@@@@@@@@@@@@@@
@@        @@@   @@@@@@@@@@ @@@@@      @@@@    @@@@@@@@@@@@  @@@@@@@@@@@@@@@@@@
@@       @@     @@@@@@@@@@                                 @@@@@@@@@@@@@@@@@@@
@@      @@      @@@@@@@@@@@@                             @@@@@@@@@@@@@@@@@@@@@
@@@    @@      @@@@@@@@@@@@@@@@@                      @@@@@@@@@@@@@@@@@@@@@@@@
@@@           @@@@@@@@@@@@@@@@@@@@@@@        @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
"""

print(intro_text)
print("Patalliro! Stardust Project 1983")
time.sleep(2)  # Пауза на 2 секунды

# Основной игровой цикл
while True:
    current_time = time.time()
    
    # Проверяем время для добавления динозавриков
    if current_time - last_dino_time >= 1.5:  # Интервал появления новых динозавриков
        if len(dinosaurs) < 4:  # Добавляем динозавриков только если их меньше 4
            new_dino_y = random.randint(1, height - 2)  # Генерация случайной позиции по Y
            dinosaurs.append((new_dino_y, width - 1))  # Динозаврик появляется справа
        last_dino_time = current_time    
    
    # Обновляем позиции динозавриков
    dinosaurs = [(y, x - 1) for (y, x) in dinosaurs if x > 0]  # Двигаем динозавриков влево и удаляем за пределами поля
    
    draw_game(patalliro, diamond, dinosaurs)

    # Установим новое направление
    if msvcrt.kbhit():  # Проверка нажатие клавиши
        key = msvcrt.getch()
        if key == b'8':  # Вверх
            direction = (-1, 0)
        elif key == b'2':  # Вниз
            direction = (1, 0)
        elif key == b'4':  # Влево
            direction = (0, -1)
        elif key == b'6':  # Вправо
            direction = (0, 1)

    # Вычисляем новую позицию Паталлиро
    head_x, head_y = patalliro[0]
    new_head = (head_x + direction[0], head_y + direction[1])

    # Проверка на столкновение со стенами, самим собой или динозавриками
    if (new_head[0] <= 0 or new_head[0] >= height - 1 or  # Учитываем верхнюю и нижнюю границы
        new_head[1] < 0 or new_head[1] >= width or
        new_head in patalliro):  # Проверка на столкновение с собой
        display_game_over(collected_diamonds)  # Отображаем стандартное сообщение "Game Over"
        break

    if new_head in dinosaurs:  # Проверка на столкновение с динозавриками
        display_dino_game_over(collected_diamonds)  # Отображаем "Game Over" при столкновении с динозавриками
        break

    # Добавляем мешок
    patalliro.insert(0, new_head)

    # Проверка, собрал ли паталиро алмаз
    if new_head == diamond:
        diamond = (
            random.randint(1, height - 2),  # Обеспечиваем, чтобы алмаз не появлялся на границах
            random.randint(1, width - 2)
        )
        collected_diamonds += 1  # Увеличиваем счетчик собранных алмазов
    else:
        # Убираем мешки, если алмаз не собран
        patalliro.pop()

    # Устанавливаем задержку для управления скоростью игры
    time.sleep(0.1)
